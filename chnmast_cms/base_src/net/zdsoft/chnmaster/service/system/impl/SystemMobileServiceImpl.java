package net.zdsoft.chnmaster.service.system.impl;import java.io.IOException;import java.io.InputStream;import java.io.InputStreamReader;import java.util.Properties;import org.apache.commons.lang3.StringUtils;import org.springframework.stereotype.Service;import com.alibaba.fastjson.JSONObject;import net.zdsoft.chnmaster.config.Config;import net.zdsoft.chnmaster.service.system.SystemMobileService;import net.zdsoft.common.cache.BaseCacheServiceImpl;import net.zdsoft.common.constant.BaseConstants;import net.zdsoft.common.filesystem.util.FileSystemUtil;/** * * @author Administrator * @version $Revision: 1.0 $, $Date: 2015-8-7 上午11:22:50 $ */@Service("systemMobileService")public class SystemMobileServiceImpl extends BaseCacheServiceImpl implements SystemMobileService {    @Override    public JSONObject getMobileConfig(long agencyId) {        // JSONObject json = getObjectFromCache(new CacheObjectParam<JSONObject>() {        //        // @Override        // public String fetchKey() {        // return DataKeyConstants.GET_MOBILE_CONFIG;        // }        //        // @Override        // public String getDataType() {        // return DataTypeConstants.SYSTEM_CONFIG;        // }        //        // @Override        // public Long getAgencyId() {        // return 0l;        // }        //        // @Override        // public JSONObject fetchObject() {        // InputStream in = null;        // Properties prop = new Properties();        // try {        // in = FileSystemUtil.getFileAsStream("sysfile/mobile/config.properties");        // prop.load(new InputStreamReader(in, "utf-8"));        // }        // catch (Exception e) {        // log.error("获取手机端配置信息失败", e);        // return null;        // }        // finally {        // if (in != null) {        // try {        // in.close();        // }        // catch (IOException e) {        // e.printStackTrace();        // }        // }        // }        // JSONObject json = new JSONObject();        //        // // ios        // JSONObject jsonItem = new JSONObject();        // jsonItem.put("version", prop.getProperty("ios_version"));        // jsonItem.put("url", prop.getProperty("ios_url"));        // /*        // * if (ResourcesLoad.getDevMode()) { jsonItem.put("url", prop.getProperty("ios_url_dev")); }        // */        // json.put("ios", jsonItem);        //        // // android        // jsonItem = new JSONObject();        // jsonItem.put("version", prop.getProperty("android_version"));        // String apk = null;        // if (StringUtils.isNotBlank(prop.getProperty("android_name"))) {        // apk = Config.getParam(BaseConstants.DOMAIN_UPLOAD_FILE);        // apk += "/sysfile/mobile/" + prop.getProperty("android_name");        // }        // jsonItem.put("name", apk);        // jsonItem.put("info", prop.getProperty("android_info"));        // json.put("android", jsonItem);        //        // // 其他        // json.put("serverTest", prop.getProperty("server_test"));        // json.put("defaultPage", prop.getProperty("default_page"));        // if (json.getString("defaultPage") == null) {        // json.put("defaultPage", "");        // }        //        // json.put("trainDomain", Config.getParam(BaseConstants.DOMAIN_HOME));        //        // // 手机端地址        // json.put("mobileDomain", Config.getParam(BaseConstants.DOMAIN_MOBILE));        // json.put("logSwitch", "1");        //        // String versionForceUpdate = prop.getProperty("versionForceUpdate");        // if (StringUtils.isBlank(versionForceUpdate)) {        // versionForceUpdate = "true";        // }        // json.put("versionForceUpdate", versionForceUpdate);// 版本强制更新        //        // // ios端domain地址        // json.put("iosDomain", prop.getProperty("iosDomain"));        //        // // qq的appId        // json.put("qqAppId", Config.getParam(BaseConstants.QQ_MOBILE_APP_ID));        // return json;        // }        // });        InputStream in = null;        Properties prop = new Properties();        try {            in = FileSystemUtil.getFileAsStream("sysfile/mobile/config.properties");            prop.load(new InputStreamReader(in, "utf-8"));        }        catch (Exception e) {            log.error("获取手机端配置信息失败", e);            return null;        }        finally {            if (in != null) {                try {                    in.close();                }                catch (IOException e) {                    e.printStackTrace();                }            }        }        JSONObject json = new JSONObject();        // ios        JSONObject jsonItem = new JSONObject();        jsonItem.put("version", prop.getProperty("ios_version"));        jsonItem.put("url", prop.getProperty("ios_url"));        /*         * if (ResourcesLoad.getDevMode()) { jsonItem.put("url", prop.getProperty("ios_url_dev")); }         */        json.put("ios", jsonItem);        // android        jsonItem = new JSONObject();        jsonItem.put("version", prop.getProperty("android_version"));        String apk = null;        if (StringUtils.isNotBlank(prop.getProperty("android_name"))) {            apk = Config.getParam(BaseConstants.DOMAIN_UPLOAD_FILE);            apk += "/sysfile/mobile/" + prop.getProperty("android_name");        }        jsonItem.put("name", apk);        jsonItem.put("info", prop.getProperty("android_info"));        json.put("android", jsonItem);        // 其他        json.put("serverTest", prop.getProperty("server_test"));        json.put("defaultPage", prop.getProperty("default_page"));        if (json.getString("defaultPage") == null) {            json.put("defaultPage", "");        }        json.put("trainDomain", Config.getParam(BaseConstants.DOMAIN_HOME));        // 手机端地址        json.put("mobileDomain", Config.getParam(BaseConstants.DOMAIN_MOBILE));        json.put("logSwitch", "1");        String versionForceUpdate = prop.getProperty("versionForceUpdate");        if (StringUtils.isBlank(versionForceUpdate)) {            versionForceUpdate = "true";        }        json.put("versionForceUpdate", versionForceUpdate);// 版本强制更新        // ios端domain地址        json.put("iosDomain", prop.getProperty("iosDomain"));        // qq的appId        json.put("qqAppId", Config.getParam(BaseConstants.QQ_MOBILE_APP_ID));        return json;    }}